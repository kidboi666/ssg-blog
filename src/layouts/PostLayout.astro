---
import TableOfContents from "@components/TableOfContents.astro";
import ToggleTableOfContents from "@components/ToggleTableOfContents";
import Layout from "./Layout.astro";
import { getEntry } from "astro:content";

const { frontmatter } = Astro.props;
const { slug } = Astro.params;

const post: any = await getEntry(frontmatter.category, slug);
const { headings } = await post.render(post);
---

<Layout headings={headings}>
  <div class="flex flex-col xl:flex-row xl:justify-center">
    <ToggleTableOfContents client:only="preact" headings={headings} />
    <div
      class="post prose prose-zinc max-w-none dark:prose-invert prose-headings:mt-[1em] prose-headings:text-zinc-700 prose-p:text-zinc-600 prose-strong:text-zinc-700 prose-code:bg-zinc-300 dark:prose-headings:text-zinc-200 dark:prose-p:text-zinc-400 dark:prose-strong:text-zinc-200 dark:prose-code:bg-zinc-600"
    >
      <div class="my-8 w-full px-4 md:px-8 xl:max-w-[752px]">
        <h1 class="m-0 text-5xl">
          {frontmatter.title}
        </h1>
        <p class="ml-px mt-2 text-sm text-zinc-500">
          등록일 : {new Date(frontmatter.pubDate).toLocaleDateString()}
        </p>
      </div>
      <div class="mt-8 w-full border-b border-zinc-200 dark:border-zinc-800">
      </div>
      <section class="my-8 w-full px-4 md:px-8 xl:max-w-[752px]">
        <slot />
      </section>
    </div>
    <TableOfContents headings={headings} />
  </div>
</Layout>
<!-- 
<script is:inline>
  const navLinks = document.querySelectorAll(".heading");

  navLinks.addEventListener("DOMContentLoaded", () => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        const targetId = entry.target.id;

        // 현재 화면에 보이는 섹션만 활성화
        if (entry.isIntersecting) {
          navLinks.forEach((link) => {
            link.classList.toggle(
              "active",
              link.getAttribute("href") === `#${targetId}`,
            );
          });
        }
      });
    });
    // 모든 섹션을 관찰
    document.getElementsByTagName("h1").forEach((section) => {
      observer.observe(section);
    });
  });
</script> -->
